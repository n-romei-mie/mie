!function(){let e=document.getElementById("seqCanvas"),t=e.getContext("2d",{alpha:!1,desynchronized:!0});t.imageSmoothingEnabled=!0,t.imageSmoothingQuality="high";let n=e.dataset.base||"",a=(e.dataset.ext||"webp").toLowerCase(),i=parseInt(e.dataset.frames||"0",10),l=parseInt(e.dataset.pad||"5",10),r=parseInt(e.dataset.start||"0",10);if(!n||!i){console.error("seqCanvas: manca data-base o data-frames");return}let s=e.parentElement||e,o=0,c=0,h=1,d=0,f=0;function u(){h=Math.min(window.devicePixelRatio||1,2);let n=Math.max(1,Math.round(s.clientWidth*h)),a=Math.max(1,Math.round(s.clientHeight*h));(e.width!==n||e.height!==a)&&(e.width=n,e.height=a,t.setTransform(1,0,0,1,0,0),t.scale(h,h)),o=Math.max(1,s.clientWidth),c=Math.max(1,s.clientHeight)}new ResizeObserver(()=>{u(),H()}).observe(s);let m=new Map,$=new Map,g=e=>{if(!m.has(e))return;let t=m.get(e);m.delete(e),m.set(e,t)},_=(e,t)=>{for(m.has(e)&&m.delete(e),m.set(e,t);m.size>240;){let n=m.keys().next().value,a=m.get(n);m.delete(n);try{a.close&&a.close()}catch(i){}}},w=e=>`${n}${String(e).padStart(l,"0")}.${a}`;async function x(e){let t=r;if(e<t||e>r+(i-1))return null;if(m.has(e))return g(e),m.get(e);if($.has(e))return $.get(e);let n=fetch(w(e),{cache:"force-cache"}).then(e=>{if(!e.ok)throw Error("HTTP "+e.status);return e.blob()}).then(createImageBitmap).then(t=>(_(e,t),$.delete(e),d&&f||(d=t.width,f=t.height),t)).catch(t=>($.delete(e),console.warn("Frame load fail",e,t),null));return $.set(e,n),n}let b={s:null,e:null};function v(e){let t=r,n=Math.max(t,e-72),a=Math.min(r+(i-1),e+72);if(n!==b.s||a!==b.e){b={s:n,e:a};for(let l=n;l<=a;l+=12){let s=Math.min(a,l+12-1);setTimeout(()=>{for(let e=l;e<=s;e++)m.has(e)||$.has(e)||x(e)},0)}}}function p(e){let n=(d||e.width)/(f||e.height),a=o/c,i,l;n>a?i=(l=c)*n:l=(i=o)/n;let r=(o-i)*.5,s=(c-l)*.5;t.clearRect(0,0,o,c),t.drawImage(e,r,s,i,l)}let y=r,E=null,C=!1;function H(){E&&p(E)}let k=function e(t){for(;t&&!t.classList?.contains("video-scrub_section");)t=t.parentElement;return t||document.body}(e);u();let L=Math.min(36,i);for(let z=r;z<r+L;z++)x(z);v(r),x(r).then(e=>{e&&(E=e,p(e))}),window.addEventListener("scroll",function e(){let{top:t,total:n}=function e(){let t=k.getBoundingClientRect(),n=window.scrollY+t.top,a=Math.max(1,k.offsetHeight-window.innerHeight);return{top:n,total:a}}(),a=Math.min(1,Math.max(0,(window.scrollY-t)/n));!function e(t){let n=Math.min(r+(i-1),Math.max(r,Math.round(t*(i-1))+r));n===y||(v(y=n),C||(C=!0,requestAnimationFrame(async()=>{let e=m.get(y);if(!e)for(let t=1;t<=72;t++){if(m.has(y+t)){e=m.get(y+t);break}if(m.has(y-t)){e=m.get(y-t);break}}e&&(E=e,p(e));let a=await x(y);a&&y===n&&(E=a,p(a)),C=!1})))}(a)},{passive:!0}),window.addEventListener("resize",()=>{u(),H()},{passive:!0})}();
